<HTML>
<HEAD>
<TITLE>Modelica_StateGraph2.UsersGuide.Tutorial</TITLE>
<META name="HTML-Generator" content="Dymola">
<META name="description" content="&quot;Tutorial&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal}
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Tutorial<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_StateGraph2.UsersGuideI.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_StateGraph2.UsersGuide.Tutorial"></A><A HREF="Modelica_StateGraph2_UsersGuide.html#Modelica_StateGraph2.UsersGuide"
>Modelica_StateGraph2.UsersGuide</A>.Tutorial</H2>
<PRE></pre>
<p>
This tutorial provides an introduction into the
<b>Modelica_StateGraph2</b> package (which is often abbreviated as StateGraph2).
A <b>StateGraph2</b> model is a state diagram/state machine to model
discrete event, reactive and hybrid systems.
It is inspired by Grafcet/Sequential Function Charts (SFC), Statecharts,
Safe State Machines (SSM) and Mode Automata, and utilizes Modelica as action language.
This tutorial consists of the following sections:
</p>

<ol>
<li>&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.StepsAndTransitions"
>Steps
    and Transitions</a>&quot; gives an overview about the most important
    elements: Steps and Transitions.</li>

<li>&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.Parallel"
>Parallel</a>&quot;
    gives an overview how to construct composite subgraphs and how run subgraphs in
    parallel, either autonoumsly or with synchronization.</li>

<li>&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.Actions"
>Actions</a>&quot;
    gives an overview how to associate actions in a graphical way
    with Steps, Transitions and Parallel components.</li>

<li>&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs"
>Safe
    StateGraphs</a>&quot;
    discusses in which sense &quot;StateGraph2&quot; models
    are &quot;safe&quot;.</li>

<li>&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.VectorsOfConnectors"
>Vectors
    of Connectors</a>&quot;
    sketches how connections to vectors of connectors (which are often used in the
    StateGraph2 library) are automatically handled in a convenient way.</li>

<li>&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.ApplicationExample"
>Application Example</a>&quot;
    gives a more involved application example: The control of a two tank system.</li>
</ol>

<pre>
</PRE><P>

<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica_StateGraph2.UsersGuide.TutorialS.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.StepsAndTransitions" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.StepsAndTransitions"
>StepsAndTransitions</A>
</TD><TD>Steps and Transitions</TD></TR>
<TR><TD><IMG SRC="Modelica_StateGraph2.UsersGuide.TutorialS.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.Parallel" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.Parallel"
>Parallel</A>
</TD><TD>Parallel</TD></TR>
<TR><TD><IMG SRC="Modelica_StateGraph2.UsersGuide.TutorialS.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.Actions" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.Actions"
>Actions</A>
</TD><TD>Actions</TD></TR>
<TR><TD><IMG SRC="Modelica_StateGraph2.UsersGuide.TutorialS.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial_SafeStateGraphs.html#Modelica_StateGraph2.UsersGuide.Tutorial.SafeStateGraphs"
>SafeStateGraphs</A>
</TD><TD>Safe StateGraphs</TD></TR>
<TR><TD><IMG SRC="Modelica_StateGraph2.UsersGuide.TutorialS.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.VectorsOfConnectors" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.VectorsOfConnectors"
>VectorsOfConnectors</A>
</TD><TD>Vectors of Connectors</TD></TR>
<TR><TD><IMG SRC="Modelica_StateGraph2.UsersGuide.TutorialS.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.ApplicationExample" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.ApplicationExample"
>ApplicationExample</A>
</TD><TD>Application example</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE StepsAndTransitions<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_StateGraph2.UsersGuideI.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.StepsAndTransitions" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_StateGraph2.UsersGuide.Tutorial.StepsAndTransitions"></A><A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial"
>Modelica_StateGraph2.UsersGuide.Tutorial</A>.StepsAndTransitions</H2>
<PRE></pre>
<p>
The basic elements of a StateGraph2 model are
<A HREF="Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Steps</a> and
<A HREF="Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Transitions</a>.
An example is shown in the next Figure:
</p>

<blockquote>
<img src="../Images/StateGraph/UsersGuide/StepAndTransition1.png">
</blockquote>

<p>
The Figure above is a screen-shot of the diagram animation of the
StateGraph2 model: Whenever a Step is active or a Transition can fire,
the corresponding component is marked in <b>green</b> color.
</p>

<p>
<b>Steps</b> represent the possible states a StateGraph2 can have.
If a Step is active the Boolean variable <b>active</b> of
the Step is <b>true</b>. If it is deactivated,
<b>active</b> = <b>false</b>. At the initial time, all &quot;usual&quot;
Steps are deactivated. The <b>inital Step</b> objects are Steps
that are activated at the initial time. They are characterized
by a small arrow pointing to the Step (see Figure above) and are defined by setting
parameter &quot;initialStep = <b>true</b>&quot; in a Step, see next Figure.
</p>

<blockquote>
<img src="../Images/StateGraph/UsersGuide/StepAndTransition1b.png">
</blockquote>

<p>
<b>Transitions</b> are used to change the state of a StateGraph2.
When the Step connected to the input of a Transition is active
and the Transition condition becomes <b>true</b>, then the
Transition fires. This means that the Step connected to the input to the
Transition is deactivated and the Step connected to the output
of the Transition is activated.
</p>

<p>
The Transition <b>condition</b> is defined via the parameter menu
of the Transition object. Clicking on object &quot;T1&quot; in
the above Figure, results in the following menu:
</p>

<blockquote>
<img src="../Images/StateGraph/UsersGuide/StepAndTransition2.png">
</blockquote>

<p>
In the input field &quot;<b>condition</b>&quot;, any type of time varying
Boolean expression can be given (in Modelica notation, this is
a modification of the time varying variable <b>condition</b>).
Whenever this condition is true, the Transition can fire.
Additionally, it is possible to activate a timer, via
<b>delayedTransition</b> (see menu above) and provide a
<b>waitTime</b>. In this case the firing of the Transition
is delayed according to the provided waitTime, provided
that the condition remains true and the preceding Step
remains active during the entire waitTime.
The Transition
condition and the waitTime are displayed in the Transition icon.
</p>

<p>
In the above example, the simulation starts at <b>initialStep</b>.
After 2 seconds, Transition <b>T1</b> fires and <b>Step2</b> becomes
active. After another second Transition <b>T2</b> fires and
<b>Step3</b> becomes active. After an additional second Transition
<b>T3</b> fires and <b>intialStep</b> becomes active. Since
time &gt;2, <b>T1</b> fires at once and <b>Step2</b> becomes active
again, and so on.
</p>

<p>
In JGrafcharts, Grafcet and Sequential Function Charts, the
network of Steps and Transitions is drawn from top to bottom.
In StateGraph2 models, no particular direction is defined, since
Steps and Transitions are models with input and output connectors
that can be arbitrarily placed and connected.
Since users of Grafcet and SFC are used to the &quot;top to bottom drawing&quot;, in all
examples of this library, this <b>convention</b> is used.
This has the additional advantage that block diagrams to program
actions can be conveniently drawn from left to right as it is usual
for block diagrams.
</p>

<p>
When parameter <b>use_conditionPort</b> is enabled at a Step,
the firing condition
can be provided as Boolean input signal, instead as entry in the
menu of the Transition. An example is given in the next
Figure:
</p>

<blockquote>
<img src="../Images/StateGraph/UsersGuide/StepAndTransition3.png">
</blockquote>

<p>
In the Figure, additionally parameter <b>use_activePort</b> is set
to <b>true</b> at <b>Step2</b> to provide the active flag of this
Step as Boolean output signal. To this output, component
<A HREF="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean.OnDelay"
>OnDelay</a>
is connected.
If the input of this block becomes <b>true</b>, the output becomes <b>true</b>
after a delay time. If the input of this block becomes <b>false</b>, the output
is immediately reset to <b>false</b> as well.
The output signal of the onDelay block is used as condition input of the
Transition. As a result, &quot;T2&quot; fires, once Step
&quot;Step2&quot; has been active for 1 second.
Of course, any other
Modelica block with a Boolean output signal can be
connected to the condition input of such a Transition block
as well. More details how define such actions graphically
are given in section
&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.Actions"
>Actions</a>&quot;
</p>

<p>
Subgraphs can be aggregated into superstates by using the
<A HREF="Modelica_StateGraph2.html#Modelica_StateGraph2.Parallel"
>Parallel</a>
component. This component acts both as a composite step (having just <u>one branch</u>) and as a Step that has <u>parallel branches</u> that
are executed in parallel to each other. For details, see
&quot;<A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial.Parallel"
>section Parallel</a>&quot;.
</p>

<p>
The execution model of a StateGraph2 graph follows from its
Modelica implementation: Given the states of all Steps, i.e.,
whether a Step is active or not active, the equations of all
Steps, Transitions, Transition conditions, actions etc. are
sorted resulting in an execution sequence to compute
essentially the new values of the Steps. If conflicts occur,
e.g., if there are more equations as variables, of if there
are algebraic loops between Boolean variables, an error
occurs. Once all equations have been processed, the
<b>active</b> variables of all Steps are updated to the newly
calculated values. Afterwards, the equations are again
evaluated. The iteration stops, once no Step changes
its state anymore, i.e., once no Transition fires anymore.
Then, simulation continuous until a new event is triggered,
(when a relation changes its value).
</p>
<p>
With the Modelica_EmbeddedSystems library a StateGraph2 model can also
be executed within a discrete controller that is called
periodically. Furthermore, production code can be downloaded to
a target processor.
</p>

<pre>
</PRE><P>

<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Parallel<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_StateGraph2.UsersGuideI.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.Parallel" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_StateGraph2.UsersGuide.Tutorial.Parallel"></A><A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial"
>Modelica_StateGraph2.UsersGuide.Tutorial</A>.Parallel</H2>
<PRE></pre>
<p>
Subgraphs can be aggregated into superstates by using the
<A HREF="Modelica_StateGraph2.html#Modelica_StateGraph2.Parallel"
>Parallel</a>
component. This component acts both as a composite step (having just <u>one branch</u>) and as a Step that has <u>parallel branches</u> that
are executed in parallel to each other.
The Parallel component allows the user to place any StateGraph2 element inside it, especially Steps, Transitions, and Parallel components. In the following Figure, a typical Parallel component &quot;p&quot; is shown:
</p>

<blockquote>
<img src="../Images/StateGraph/Elements/Parallel.png">
</blockquote>

<p>
Here, the branch from &quot;Step3&quot; to &quot;Step5&quot; is executed in parallel to &quot;Step2&quot;. A Transition connected to the output of a parallel branch component can only fire if the final Steps
of the branches, that are connected to the &quot;exit&quot; port of the
Parallel component, are active simultaneously. So, in the Figure above,
the Parallel component is left, once Step2 and Step5 are active for one
second, since then transition T5 fires.
</p>

<p>
By default, a Parallel component does not have any outside ports.
To achieve the StateGraph2 above, parameters <b>use_inPort</b>, <b>use_outPort</b>, and
<b>use_suspend</b> have to be set to <b>true</b>, see next Figure:
</p>

<blockquote>
<img src="../Images/StateGraph/UsersGuide/Parallel2.png">
</blockquote>

<p>
A Parallel component has always an entry port, see Figure above, and it may have optionally an exit port. All branches in a Parallel Component must start at the entry port and at least one must terminate at the exit port, provided the exit port is enabled via parameter <b>use_outPort</b>. If a Parallel component shall be entered from the outside via a Transition, parameter <b>use_inPort</b> must be set to true, to enable an input port. If a Parallel Component shall be left via a transition to an outside step, parameter <b>use_outPort</b> must be set to true, to enable the output and the exit port. A Parallel component may be used as initial step, by setting parameter <b>initialStep</b> to true.
All branches in a Parallel component may be running autonomously in parallel, by setting
use_inPort=<b>false</b>, use_outPort=<b>false</b>, initialStep=<b>true</b>.
</p>

<p>
A Parallel component may be <u>suspended</u> and sub-sequently <u>resumed</u>. In the Figure above, Transition T6 fires whenever the input signal &quot;u&quot; is true, suspending the Parallel component &quot;p&quot; and the enclosed Steps s2, s3, s4 and s5 for two seconds. When Transition T7 fires, p is re-activated in the same states as when it was suspended (i.e., the same Steps become active, that have been active when the Parallel component was suspended).
</p>

<p>
Parallel and Step components have vectors of
connectors. The dimensions of these vectors are set <b>automatically</b>
in the corresponding parameter menu when performing a connection due
to the &quot;connectorSizing&quot; annotation (a connection is connected to
the next free element of a vectors of connectors when drawing the
connection and the new vector dimension is set automatically as
a modifier, if the dimension needs to be enlarged). If several Transitions could
fire, the Transition that is connected to the lowest index of a vector
of connectors really fires (so the firing priority is defined with the
connection index). If transitions connected to the outPort and to the suspend port could fire
at the same time instant, the transition connected to the outPort has higher priority
and really fires.
</p>


<p>
As mentioned above, inPorts and outPorts of a Parallel component are optional and can be set by the user. If the parallel component has an inPort, then the entry port constitutes the connection between the Transition connected to the inPort and the first Steps to be activated in the Parallel component. If the Parallel component is configured to have an outPort, an exit port shows up on the bottom of the Parallel component, see above Figure.
The Parallel component allows the entry port to branch out into several parallel paths. These branches are not allowed to interact. When all Steps connected to the exit port are active, the Parallel component is said to be available and may exit when the Transition connected to the outPort fires. In the Figure above Transition T5 fires when both Step s2 and s5 have been active together for one second and thereby deactivates the Parallel component p. Note, not all branches need to be connected to the exit port, if it is enabled.
</p>

<p>
The state of a Parallel component is available via the output variable <b>active</b> that can
be used in action blocks (e.g. "parallel.active"). Alternatively, via parameter
"use_activePort" the Boolean output port "activePort" can be enabled.
When the Parallel component is active, activePort = <b>true</b>, otherwise it is <b>false</b>. This port can
be connected to Boolean action blocks, e.g., from
<A HREF="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean"
>Modelica_StateGraph2.Blocks.MathBoolean</a>.
</p>

<p>
No component contained within the Parallel component may be connected to any other component &quot;outside&quot; of the Parallel component, otherwise a translation error occurs. This rule is used to protect the user from making mistakes that could lead to unexpected results and states of the graph that are not well-defined.
</p>

<p>
In order to graphically organize large graphs in different levels of hierarchy and with encapsulation of variables, use component
<A HREF="Modelica_StateGraph2.html#Modelica_StateGraph2.PartialParallel"
>PartialParallel</a> instead of
Parallel.
</p>

<pre>
</PRE><P>

<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Actions<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_StateGraph2.UsersGuideI.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.Actions" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_StateGraph2.UsersGuide.Tutorial.Actions"></A><A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial"
>Modelica_StateGraph2.UsersGuide.Tutorial</A>.Actions</H2>
<PRE></pre>
<p>
An important practical aspect of state machines is the ability to assign values and expressions to variables depending on the state of the machine. In StateGraph2, a number of graphical components have been added
to package <A HREF="Modelica_StateGraph2_Blocks.html#Modelica_StateGraph2.Blocks"
>Modelica_StateGraph2.Blocks</a>
to facilitate usage in a safe and intuitive way. Since these are just input/output blocks and will also be useful in another context, it is planned to add them to the Modelica Standard Library.
</p>

<p>
There are a number of standard blocks with common operations/displays of the three basic types (Boolean, Integer, Real) using vector input connectors which enables them to be connected to an arbitrary number of sources. Resizing a vector port and connecting to the next free element is performed automatically when connecting to the connector. So this is much more convenient as with the
<A HREF="../../Modelica 3.2/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical"
>Modelica.Blocks.Logical</a>
blocks. A vector of input connectors is visualized as an ellipse
(see the violet ellipse on the left side of the multiSwitch components in the Figures below).
</p>

<p>
The most important action blocks are the MultiSwitch blocks for the different basic data types
(<A HREF="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean.MultiSwitch"
>MathBoolean.MultiSwitch</a>,
<A HREF="Modelica_StateGraph2_Blocks_MathInteger.html#Modelica_StateGraph2.Blocks.MathInteger.MultiSwitch"
>MathInteger.MultiSwitch</a>,
<A HREF="Modelica_StateGraph2_Blocks_MathReal.html#Modelica_StateGraph2.Blocks.MathReal.MultiSwitch"
>MathReal.MultiSwitch</a>).
These block select one of N (Boolean, Integer, or Real) expressions depending on an array of Boolean inputs. The index of the first input in the Boolean array that is true defines the index of the expression in the expression array to be used as the scalar output y.
</p>

<p>
<img src="../Images/StateGraph/Elements/MultiSwitch.png" align="right">
In the Figure to the right, the MultiSwitch component will output the value y = 1 if Step s1 is active, and will output y = 2 if s2 is active as the expression array is defined as {1,2}. If none of the Boolean array inputs is true, the &quot;else&quot; value will be used instead that is defined in the parameter menu of the MultiSwitch component and is displayed below the icon. Consider the Figure when Step s3 is active - this will set the output of component &quot;multiSwitch&quot; to the &quot;else&quot; value &quot;3&quot;. Alternatively, in the parameter menu of the MultiSwitch component it can be defined to keep its previous value, i.e., y = <b>pre</b>(y). If this option would be selected for the Figure to the right, then multiSwitch.y = 2 when Step s3 is active.
</p>

<p>
The MultiSwitch block is inspired by &quot;Modes&quot; from Mode Automata (Maraninchi and Rémond 2002, see
<A HREF="Modelica_StateGraph2_UsersGuide.html#Modelica_StateGraph2.UsersGuide.Literature"
>Literature</a>): Variable multiSwitch.y has always a unique value, and this value depends on the expressions that are associated with mutually exclusive active steps. The advantages of MultiSwitch are that (1) the definition is performed in a purely graphical way, (2) it can also be used for mutually non-exclusive active steps in a Parallel component, and (3) it can be implemented in Modelica in a very simple way. The drawback is that the expressions in the MultiSwitch block might no longer be so easy associated with Steps, compared to the alternative where the expressions are defined directly in the respective Steps. This latter approach would, however, require non-trivial extensions to the Modelica language.
</p>

<p>
The
<A HREF="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean.RisingEdge"
>RisingEdge</a>,
<A HREF="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean.FallingEdge"
>FallingEdge</a> and
<A HREF="Modelica_StateGraph2_Blocks_MathBoolean.html#Modelica_StateGraph2.Blocks.MathBoolean.ChangingEdge"
>ChangingEdge</a>,
components can be used to generate &quot;pulse&quot; signals depending on the rising, falling or changing values of a Boolean signal. An example is shown in the Figure below where the Boolean indicator lamp is turned on when Step s2 becomes active and is turned off when Transition t3 fires and Step s3 becomes inactive. Two variants are shown to utilize the &quot;rising&quot; property of a Boolean signal: The Boolean connectors at Steps and Transitions can be activated via parameters &quot;use_activePort&quot; and &quot;use_firePort&quot;, respectively. If s2 becomes active, rising = true and therefore multiSwitch.y = true. If transition t3 fires, t3.firePort=true and therefore multiSwitch.y = false.
</p>

<blockquote>
<img src="../Images/StateGraph/Elements/RisingEdge.png">
</blockquote>
<pre>
</PRE><P>

<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE VectorsOfConnectors<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_StateGraph2.UsersGuideI.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.VectorsOfConnectors" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_StateGraph2.UsersGuide.Tutorial.VectorsOfConnectors"></A><A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial"
>Modelica_StateGraph2.UsersGuide.Tutorial</A>.VectorsOfConnectors</H2>
<PRE></pre>
<p>
<img src="../Images/StateGraph/Elements/Step-default.png" align="right">
The &quot;inPort&quot; (= ellipse at the top part of a Step; see Figure to the right),
the &quot;resume&quot; port (= ellipse at the left part of a Parallel component),
the &quot;outPort&quot; (= triangle at the bottom part of a Step and of a Parallel
component), and
the &quot;suspend&quot; port (= triangle at the left part of a Parallel component)
connectors are <u>vector of connectors</u>, respectively.
When drawing a connection line from, e.g., a Transition to a Step inPort connector, the dimension of the vector of connectors Step.inPort has to be increased by one, say to dimension N, and then the connection has to be performed from Transition.outPort to Step.outPort[N]. Performing this manually is inconvenient and error prone. For this reason, in
<a href="http://www.modelica.org/documents/ModelicaSpec31.pdf">Modelica 3.1</a> (section 17.6) the new annotation <u>connectorSizing</u> was introduced. This annotation is used for all vector connectors in the StateGraph2 library. Example:
</p>

<pre>
  <b>model</b> Step
     <b>parameter</b> Integer <u>nIn</u>=0 <b>annotation</b>(Dialog(<u>ConnectorSizing=<b>true</b></u>));
     Modelica_StateGraph2.Internal.Interfaces.Step_in inPort[<u>nIn</u>];
     ...
  <b>end</b> Step;
</pre>

<p>
When this model is used and a connection is made to vector &quot;inPort&quot;, then the tool increments the dimension nIn by one and performs the connection to this new index. Therefore, performing connections between Steps and Transitions or Parallel components and Transitions is convenient for a user and only requires to draw a line between the corresponding connectors.
</p>

<pre>
</PRE><P>

<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ApplicationExample<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica_StateGraph2.UsersGuideI.png" ALT="Modelica_StateGraph2.UsersGuide.Tutorial.ApplicationExample" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica_StateGraph2.UsersGuide.Tutorial.ApplicationExample"></A><A HREF="Modelica_StateGraph2_UsersGuide_Tutorial.html#Modelica_StateGraph2.UsersGuide.Tutorial"
>Modelica_StateGraph2.UsersGuide.Tutorial</A>.ApplicationExample</H2>
<PRE></pre>
<p>
In this section an application example
is shown, to demonstrate various features of the Modelica_StateGraph2 library.
This example shows the control of a two tank system which is based
on the master thesis of Isolde Dressler
(<A HREF="Modelica_StateGraph2_UsersGuide.html#Modelica_StateGraph2.UsersGuide.Literature"
>see literature</a>).
</p>
<p>
In the following figure the top level of the model is shown.
This model is available from
<A HREF="Modelica_StateGraph2_Examples_Applications_ControlledTanks.html#Modelica_StateGraph2.Examples.Applications.ControlledTanks.ControlledTanks1"
>here</a>.
</p>

<blockquote>
<img src="../Images/StateGraph/Examples/ControlledTanks1.png">
</blockquote>

<p>
In the right part of the figure, two tanks are shown. At the top part,
a large fluid source is present from which fluid can be filled in
<b>tank1</b> when <b>valve1</b> is open. Tank1 can be emptied via
<b>valve2</b> that is located in the bottom of tank2 and
fills a second <b>tank2</b> which in turn is emptied via
<b>valve3</b>. The actual levels of the tanks are measured
and are provided as signals <b>level1</b> and <b>level2</b>
to the <b>tankController</b>.
</p>
<p>
The <b>tankController</b> is controlled by three buttons,
<b>start</b>, <b>stop</b> and <b>shut</b> (for shutdown)
that are mutually exclusive. This means that whenever one button is
pressed (i.e., its state is <b>true</b>) then the other two
buttons are not pressed (i.e., their states are <b>false</b>).
When button <b>start</b> is pressed, the "normal" operation
to fill and to empty the two tanks is processed:
</p>
<ol>
<li> Valve 1 is opened and tank 1 is filled.</li>
<li> When tank 1 reaches its fill level limit,
     valve 1 is closed. </li>
<li> After a waiting time, valve 2 is
     opened and the fluid flows from tank 1 into tank 2.</li>
<li> When tank 1 is empty, valve 2 is closed. </li>
<li> After a waiting time, valve 3 is opened and
     the fluid flows out of tank 2</li>
<li> When tank 2 is empty, valve 3 is closed</liI>
</ol>
<p>
The above "normal" process can be influenced by the following
buttons:
</p>
<ul>
<li> Button <b>start</b> starts the above process.
     When this button is pressed after a "stop" or
     "shut" operation, the process operation continues.
     </li>
<li> Button <b>stop</b> stops the above process by
     closing all valves. Then, the controller waits for
     further input (either "start" or "shut" operation).</li>
<li> Button <b>shut</b> is used to shutdown the process,
     by emptying at once both tanks. When this is achieved,
     the process goes back to its start configuration.
     Clicking on "start", restarts the process.</li>
</ul>
<p>
The implementation of the <b>tankController</b> is shown in
the next figure:
</p>
<p align="center">
<img src="../Images/StateGraph/Examples/ControlledTanks2.png">
</p>
<p>
When the "<b>start</b>" button is pressed, the Modelica_StateGraph2 is
within the Parallel step "<b>makeProduct</b>". During normal
operation this step is not left.
</p>
<p>
When the "<b>stop</b>" button is pressed, the "makeProduct"
step is at once terminated via the "<b>suspend</b>" port
and the Modelica_StateGraph2 waits in step "<b>stopStep1</b>" for further
commands. When the "<b>start</b>" button is pressed, the makeProduct step
is re-entered via its <b>resume</b> port and the "normal"
operation continues at the state where it was aborted by the
suspend transition. If the "<b>shut</b>" button is pressed,
the Modelica_StateGraph2 waits in the "<b>shutStep</b>" parallel step, until
both tanks are empty and then waits at the
"<b>startStep</b>" for further input.
</p>
<p>
The opening and closing of valves is <b>not</b> directly
defined in the Modelica_StateGraph2. Instead via the "<b>setValveX</b>"
components, the Boolean state of the valves are computed.
For example, the output y of "setValve3" is computed as:
</p>
<pre>
  y = emptyTanks.active or shutTank2.active
</pre>
<p>
i.e., valve3 is open, when step "emptyTanks" or when
step "shutTank2" is active. Otherwise, valve3 is closed.
</p>

<p>
An alternative implementation of the tank controller is available from
<A HREF="Modelica_StateGraph2_Examples_Applications_ControlledTanks.html#Modelica_StateGraph2.Examples.Applications.ControlledTanks.ControlledTanks2"
>here</a>.
The differences to the implementation shown above are:
</p>

<ul>
<li> All signals are reported via a signal bus and the bus signals
     are directly utilized as conditions in transitions.</li>
<li> The controller is hierarchically structured for the different tasks
     using the
     <A HREF="Modelica_StateGraph2.html#Modelica_StateGraph2.PartialParallel"
>PartialParallel</a>
     component.</li>
</ul>

<p>
The top level of this alternative implementation of the tank controller
is shown in the following figure:
</p>

<blockquote>
<img src="../Images/StateGraph/Examples/ControlledTanks3.png">
</blockquote>

<p>
The &quot;MakeProduct&quot; Parallel component is the initial step and performs the &quot;normal&quot; operation. When the &quot;stop&quot; button is pressed, the suspend transition T8 fires, the &quot;MakeProduct&quot; step is suspended and the graph goes in to step &quot;stopStep1&quot;. Note, the transition condition of T8 is &quot;bus.stop&quot;, i.e., this transition fires when variable stop from the bus is true. When &quot;start&quot; is pressed again, the &quot;MakeProduct&quot; step is resumed at the place where it was suspended. When &quot;shut&quot; is pressed, the Parallel component &quot;ShutStep&quot; is entered to shut down the tank system. Here it is still possible to press the &quot;stop&quot; button and then again continue with &quot;shut&quot;.
</p>
<pre>
</PRE><P>

<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Fri Nov 12 17:26:46 2010.
</address></BODY>
</HTML>
